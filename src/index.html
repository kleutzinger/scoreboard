<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smash Bros State Editor</title>
  </head>
  <body>
    <div id="app">
      <h1>Smash Bros State Editor</h1>
      <div>
        <label for="p1Name">Player 1 Name:</label>
        <input
          type="text"
          id="p1Name"
          v-model="state.p1Name"
          @input="updateState"
        />
      </div>
      <!-- Add input fields for other properties -->

      <!-- Remove the "Save State" button -->
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
      const app = Vue.createApp({
        data() {
          return {
            state: {
              p1Name: "Player 1",
              // Add other properties with default values
            },
            // get roomid from url
            roomId: window.location.pathname.split("/").pop(),
            socket: null,
          };
        },
        mounted() {
          console.log("Mounted");
          this.initWebSocket();
        },
        methods: {
          initWebSocket() {
            const wsUrl = `${window.location.protocol === "https:" ? "wss" : "ws"}://${window.location.host}`;
            console.log("WebSocket URL:", wsUrl);
            // Initialize WebSocket connection
            this.socket = new WebSocket(wsUrl);

            // Listen for messages from the server
            this.socket.addEventListener("message", (event) => {
              console.log("Message from server:", event.data);
              this.state = JSON.parse(event.data);
            });

            // Fetch initial state
            this.fetchState();
          },
          fetchState() {
            fetch(`/getState/${this.roomId}`)
              .then((response) => response.json())
              .then((data) => {
                this.state = data;
              })
              .catch((error) => {
                console.error("Error fetching state:", error);
              });
          },
          updateState() {
            console.log("Updating state");
            console.log(JSON.stringify(this.state));
            fetch(`/updateState/${this.roomId}`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(this.state),
            })
              .then((response) => {
                if (!response.ok) {
                  throw new Error("Error updating state");
                }
                console.log("State updated successfully");
              })
              .catch((error) => {
                console.error("Error updating state:", error);
              });
          },
        },
      });

      app.mount("#app");
    </script>
  </body>
</html>
